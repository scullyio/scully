---
title: Plugins
order: 700
---

# <a name="plugins"></a> Plugins

Scully uses a plugin system that allows users to define new ways for Scully to pre-render an application. There are three main
types of plugins:

1. [Router Plugins](#router-plugin)
1. [Render Plugins](#render-plugin)
1. [File Handler Plugins](#file-plugin)

You can find a list of available plugins in the [recommended plugins](recommended-plugins.md) documentation.

---

## Registering a Plugin

The `registerPlugin` method adds a new plugin to Scully. This method has 4 parameters:

- type
- name
- plugin
- validator

### type: string

`type` - Indicates the type of plugin. It can be `render`, `router` or `fileHandler`.

### name: string

`name` - The plugin's name.

### plugin: any

`plugin` - The plugin's function.

### validator: function

`validator` - A validations function. It should return an array of errors.

> Tip: Add color to the validator errors by using the colors in the `log.ts` file.

##### Example:

```typescript
import {yellow} from '@scullyio/scully/utils/log';

// Omitted code ...

const validator = async options => {
  const errors = [];

  if (options.numberOfPages && typeof options.numberOfPages !== 'number') {
    errors.push(
      `my-custom-plugin numberOfPages should be a number, not a ${yellow(typeof options.numberOfPages)}`
    );
  }

  return errors;
};
```

### IMPORTANT:

_A Scully plugin must have a `.js` file extension, and it should be exported. In order to be used, it has to be required in the `scully.config.js` file by using the `require()` method._

## <a name="router-plugin"></a> Router Plugins

Any route in the application that contains a router-parameter must be configure in a **router plugin**. The plugin teaches Scully how Scully how to get the required data to be pre-render in the web-pages from the route-params.

Suppose your application has a route like this: `{path: 'user/:userId', component: UserComponent}`. In order for Scully to pre-render the
website, it needs to know the complete list of User IDs that will be used in that route parameter `:userId`. If the app
had 5 users with the IDs 1, 2, 3, 4, and 5; Scully would need to render the following routes:

```
/user/1
/user/2
/user/3
/user/4
/user/5
```

A **router plugin** is used to convert the raw route-config into a list of routes that Scully can then crawl/render.

## `HandledRoute` interface

```typescript
export interface HandledRoute {
  route: string;
  type: RouteTypes;
  postRenderers?: string[];
  templateFile?: string;
  data?: RouteData;
}
```

The `HandledRoute` interface provides the needed properties to develop your own plugin.

### route: string

`route` - An application route to be handled by Scully.

### type: RoutesTypes

`type` - Indicates the type of plugin. It can be `render`, `router` or `fileHandler`.

### postRenderers?: string[]

`postRenderers` - Array of plugins to be executed after Scully's render process.

### templateFile?: string

`templateFile` - The file's name containing the template to be rendered.

### IMPORTANT:

_It is not a reference to the angular template._

### data?: RouteData

`data` - the metadata to be added into the static file.

```typescript
export interface RouteData {
  title?: string;
  author?: string;
  [prop: string]: any;
}
```

### <a name="router-plugin-interface"></a> Router Plugin Interface

A **router plugin** is a function that returns a `Promise<HandledRoute[]>`. The `HandledRoute` interface looks like this:

```typescript
interface HandledRoute {
  route: string;
}
```

A router plugin function should be as follows:

```typescript
function exampleRouterPlugin(route: string, config: any): Promise<HandledRoute[]> {
  // Must return a promise
}
```

The `HandledRoute[]` gets added into the `scully-routes.json` file generated by the `npm run scully` command.

### <a name="router-plugin-how-to"></a> Making A Router Plugin

Lets implement the **router plugin** that turns the raw route into five distinct HandledRoutes from the previous example of an application containing the following route: `/user/:userId`.

```javascript
const {registerPlugin} = require('@scullyio/scully');

function userIdPlugin(route: string, config = {}): Promise<HandledRoute[]> {
  return Promise.resolve([
    {route: '/user/1'},
    {route: '/user/2'},
    {route: '/user/3'},
    {route: '/user/4'},
    {route: '/user/5'},
  ]);
}

// DO NOT FORGET TO REGISTER THE PLUGIN
const validator = async conf => [];
registerPlugin('router', 'userIds', userIdPlugin, validator);
```

After implementing the plugin, configure the `scully.config.js` in order to use it.

### <a name="router-plugin-configure"></a> Configuring a Router Plugin

The following configuration uses the `userIds` router plugin to get the `HandledRoute[]` for the above implementation:

```javascript
// scully.config.js
exports.config = {
  // Add the following to your file
  routes: {
    '/user/:userId': {
      type: 'userIds',
    },
  },
};
```

The following example uses the [jsonplaceholder](http://localhost:8200/) to fetch a list of
user ID's for the application. It uses the [JSON Plugin](../scully/routerPlugins/jsonRoutePlugin.ts) which is part of Scully.

```javascript
// scully.config.js
exports.config = {
  // Add the following to your file
  routes: {
    '/user/:userId': {
      type: 'json',
      userId: {
        url: 'http://localhost:8200/users',
        property: 'id',
      },
    },
  },
};
```

The above example tells Scully to use the `json` plugin for fetching some JSON data via HTTP whenever it finds a route matching `/user/:userId`.
The `userId`'s value contains two pieces of data. First, the url that the JSON plugin should go to in order to get the required JSON.
Second, the `id` property.

The JSON plugin will pluck the provided property name from each of the items in the `HandledRoute[]` array. In other words,
the data array returned by the `jsonplaceholder` API, each containing an `id` property. Therefore, returning return a list of `userIds` instead of a list
of users.

The JSON plugin also accepts any header needed when making an API request.

##### Example:

```javascript
// scully.config.js
exports.config = {
  routes: {
    '/todos/:todoId': {
      type: 'json',
      todoId: {
        url: 'https://my-api.com/todos',
        property: 'id',
        headers: {
          'API-KEY': '0123456789',
        },
      },
    },
  },
};
```

### <a name="router-plugin-configure"></a> Router Plugin Examples

Here are some links to built-in **router plugins** in Scully:

- [JSON Plugin](../scully/routerPlugins/jsonRoutePlugin.ts)
- [Content Folder Plugin](../scully/routerPlugins/contentFolderPlugin.ts)

---

## <a name="render-plugin"></a> Render Plugins

A **render plugin** is used to transform the rendered HTML.

After the Angular application renders, the HTML content is passed to a **render plugin** where it can be further modified.

A render plugin could be used to transform a page containing markdown into a page that renders it.

### <a name="render-plugin-interface"></a> Render Plugin Interface

A **render plugin** is a function that returns a `Promise<String>`. The string in the promise must be the transformed
HTML. The interface looks like this:

```typescript
function exampleContentPlugin(HTML: string, route: HandledRoute): Promise<string> {
  // Must return a promise
}
```

### <a name="render-plugin-how-to"></a> Making A Render Plugin

The following **render plugin** example adds a title to the header to a page if it does not find one.

```typescript
const {registerPlugin} = require('@scullyio/scully');

function defaultTitlePlugin(html, route) {
  // If no title in the document
  if (html.indexOf('<title') < 0) {
    const splitter = '</head>';
    const [begin, end] = html.split(splitter);
    const defaultTitle = `<title>The Truth Is Out There!</title>`;
    return Promise.resolve(`${begin}${defaultTitle}${splitter}${end}`);
  }
  return Promise.resolve(html);
}

// DON NOT FORGET REGISTER THE PLUGIN
const validator = async conf => [];
registerPlugin('render', 'defaultTitle', defaultTitlePlugin, validator);

module.exports.defaultTitlePlugin = defaultTitlePlugin;
```

In the above example, the Angular app's HTML content is transformed to include a title because anyone was found.

The next example replaces any instances of `:)` with an smiley emoji.

```typescript
const {registerPlugin} = require('@scullyio/scully');

function smileEmojiPlugin(html, route) {
  return Promise.resolve(html.replace(/\:\)/g, 'ðŸ˜Š'));
}
// DON NOT FORGET REGISTER THE PLUGIN
const validator = async conf => [];
registerPlugin('render', 'smiles', smileEmojiPlugin, validator);

module.exports.smileEmojiPlugin = smileEmojiPlugin;
```

### <a name="render-plugin-configure"></a> Render Plugin Examples

Here are some links to built-in **render plugins** in Scully:

- [Route Content Renderer Plugin](../scully/renderPlugins/routeContentRenderer.ts)

---

## <a name="file-plugin"></a> File Handler Plugins

A **file handler plugin** is used by the `contentFolder` plugin during the `render` process. The `contentFolder`
plugin processes the folders for markdown files or other file type the folders may contain. The `render` process any existing `fileHandler` plugin for any file extension type.

Scully comes with two built-in `fileHandler` plugins. The [markdown plugin](../scully/fileHanderPlugins/markdown.ts) and
the [asciidoc plugin](../scully/fileHanderPlugins/asciidoc.ts). These plugins handle and process the
content of those file types as they are read from the file system.

If you want to support `.docx` files, or `.csv` files, or any other file type; a file handler for those file types need to be added.
The `contentFolder` plugin takes care of reading those files from the filesystem. However, if the files need to be transformed after the `contentFolder` plugin reads them;
A `fileHandler` plugin is required.

### <a name="file-plugin-interface"></a> File Handler Plugin Interface

A **file handler plugin** is a function that returns a `Promise<string>`. The interface looks like follows:

```typescript
function exampleFileHandlerPlugin(rawContent: string): Promise<string> {
  // Must return a promise
}
```

### <a name="file-plugin-how-to"></a> Making A File Handler Plugin

The following **file handler plugin** example handles `.cvs` files by wrapping them into a code block. You could write a much more elaborate plugin that creates a table or a grid for the data.

```typescript
function csvFilePlugin(raw) {
  return Promise.resolve(`<pre><code>${code}</code></pre>`);
}
// DO NOT FORGET TO REGISTER THE PLUGIN
registerPlugin('fileHandler', 'csv', {handler: csvFilePlugin});
module.exports.csvFilePlugin = csvFilePlugin;
```

### <a name="file-plugin-configure"></a> File Handler Plugin Examples

Here are some links to built-in **render plugins** in Scully:

- [asciidoc Plugin](../scully/fileHanderPlugins/asciidoc.ts)
- [markdown Plugin](../scully/fileHanderPlugins/markdown.ts)
